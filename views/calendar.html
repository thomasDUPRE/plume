
	<meta charset="utf-8">
	<link href="../vendors/fullcalendar/dist/fullcalendar.min.css" rel="stylesheet">
	<link href="../vendors/fullcalendar/dist/fullcalendar.print.css" rel="stylesheet" media="print">
	    <!-- iCheck -->
    <link href="../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <link href="../vendors/iCheck/skins/flat/blue.css" rel="stylesheet">
    
	<script src="../vendors/moment/min/moment.min.js"></script>
	<script src="../vendors/fullcalendar/dist/fullcalendar.min.js"></script>
	<script src="../vendors/fullcalendar/dist/lang/fr.js"></script> 
	<script src="../vendors/switchery/dist/switchery.min.js"></script>
	  <!-- iCheck -->
    <script src="../vendors/iCheck/icheck.min.js"></script>

	<script>
		 var id_collabo;
		 var id_service;
		 var role_collabo;
		 var nom_service;

		 function render_type(type) {
	          var tab = [];
	         
	          tab1 = $("#calendar").fullCalendar( 'clientEvents');
	          
	          for(var i=0; i<tab1.length; i++){
	            if(tab1[i].type == type) {
	                tab.push(tab1[i]); 
	            }
	          }
	          return tab;
	      }

	      function alreadyExist(my_tab, id) {
	          
	        var i=0;
	        while(my_tab[i] != null){
	            if (my_tab[i].id == id) return true;
	            i++;
	        }
	        return false;       
	      }

		 $(document).ready(function() {

		  	
 		 
    		//calendar
	    	var date = new Date(),
	          d = date.getDate(),
	          m = date.getMonth(),
	          y = date.getFullYear(),
	          started,
	          categoryClass;

	        //hide filter section

	         var calendar = $('#calendar').fullCalendar({
	          locale: 'fr',
	          header: {
	          left: 'prev,next today',
	          center: 'title',
	          right: 'month,agendaWeek,agendaDay,listMonth'
	          },
	          buttonText :{
             
              month: 'mois',
              agendaDay :'jour',
              agendaWeek :'semaine',
              listMonth: "liste congés",
              today:"Aujourd'hui"
              
        	  },
        	  slotLabelFormat:"HH:mm" ,
	          //selectable: true,
	          selectHelper: true,
	          select: function(start, end, allDay) {
	          $('#fc_create').click();

	          started = start;
	          ended = end;

	          $(".antosubmit").on("click", function() {
	            var title = $("#title").val();
	            if (end) {
	            ended = end;
	            }

	            categoryClass = $("#event_type").val();

	            if (title) {
	            calendar.fullCalendar('renderEvent', {
	              title: title,
	              start: started,
	              end: end,
	              allDay: allDay
	              },
	              true // make the event "stick"
	            );
	            }

	            $('#title').val('');

	            calendar.fullCalendar('unselect');

	            $('.antoclose').click();

	            return false;
	          });
	          },
	          eventClick: function(calEvent, jsEvent, view) {
	          $('#fc_edit').click();
	          $('#title2').val(calEvent.title);

	          categoryClass = $("#event_type").val();

	          $(".antosubmit2").on("click", function() {
	            calEvent.title = $("#title2").val();

	            calendar.fullCalendar('updateEvent', calEvent);
	            $('.antoclose2').click();
	          });

	          calendar.fullCalendar('unselect');
	          },
	          editable: true,
	          events: function(start, end, timezone, callback) {

	          			    $.ajax({
		                      url :"/name",
		                      type:'GET',
		                      dataType: 'json',
		                      data: {},

		                      success: function(doc){
		                      	$(doc).each(function() {
		                        	id_collabo = $(this)[0]["id"];
		                        	role_collabo = $(this)[0]["role"]["nom"];
		                        	id_service = $(this)[0]["service"]["id"];
		                        	nom_service = $(this)[0]["service"]["nom"];
		                    	})

	                    		if(nom_service != "RH" && role_collabo != "Dirigeant"){
        							$('#filtre_services').hide();
        						}
		                      }
		                      
				            })
 

					        $.ajax({
					            url: '/selectConge',
					            type: 'GET',
					            dataType: 'json',
					            data: {},
					            success: function(doc) {

					                var events = [];
					                
					                $(doc).each(function() {
							             switch($(this)[0]["id_etat_conge"]){
							             	//Brouillon
		                                     case 1:
		                                          $couleur = "#999999";
		                                          $etat = "Brouillon";
		                                          break;
		                                     //Envoye
		                                     case 2:
		                                          $couleur = "#5bc0de";
		                                          $etat = "Envoye";
		                                          break;
		                                     //valide_CS
		                                     case 5:
		                                          $couleur = "#5bc0de";
		                                          $etat = "Valide_CS";
		                                          break;
		                                     //Invalide_CS
		                                     case 3:
		                                          $couleur = "#d9534f";
		                                          $etat = "Invalide_CS";
		                                          break;
		                                     //Invalide_RH
		                                     case 4:
		                                          $couleur = "#d9534f";
		                                          $etat = "Invalide_RH";
		                                          break;
		                                     //Valide_RH
		                                     case 6:
		                                          $couleur =  "#5cb85c";
		                                          $etat = "Valide_RH";
		                                          break;
		                                     default:
		                                         $couleur = "#33cc33";
		                                         $etat = "?";
		                                 }
		                                 if($(this)[0]["id"]==0){
		                                 	$conge_paye="Congé payé";
		                                 }
		                                 else{
		                                 	$conge_paye="Congé sans solde";
		                                 }

		                                 //On affiche tous nos congés + congés validés seulement des autres collabos
		                                if(($(this)[0]["id_demandeur"] == id_collabo) || $etat==6 || role_collabo=="Chef de service" || nom_service=="RH"){
						                    events.push({
						                       id: $(this)[0]["id"],
	                                           title: $(this)[0]["motif"],
	                                           start: $(this)[0]["dateDebut"],
	                                           end: $(this)[0]["dateFin"],
	                                           dateDemande: $(this)[0]["date_demande"],
	                                           type: $conge_paye,
	                                           color: $couleur,
	                                           etat: $etat,
	                                           collaborateur: $(this)[0]["id_demandeur"],
						                    });
					                	}
					                });
					                callback(events);

					            }
					        });

					    },
		      timeFormat: 'H:mm',
		      eventRender: function (event, element) {
		      			 var demande = event.dateDemande.split("T")[0];
                         element.popover({
	                        trigger : 'hover',
	                        title: event.title,
	                        placement:'top',
	                        html:true,
	                        content: "Etat: "+event.etat+", id: "+event.id+", Debut: "+event.start.toISOString()+", Fin: "+event.end.toISOString()+", Demandé le: "+demande+", Demandeur: "+event.collaborateur,
                    	});   
               }

	         }); 
			
			//Affichage du volet de filtre personnalise
	         if(role_collabo=="RH" || role_collabo=="Dirigeant"){
		         $.ajax({
		                  url :"/selectservices",
		                  type:'GET',
		                  dataType: 'json',
		                  data: {},

		                  success: function(doc){
		                  	console.log("Entre")
		                  	$(doc["data"]).each(function() {
		                    	var nomService = $(this)[0]["nom"];
		                    	if(nomService != nom_service){
			                    	//console.log(nom_service)
		                    		var id_checkbox="checkbox"+nomService;
		                    		console.log(id_checkbox);
		                    		$('.filtre_services').append('<input type="checkbox" id='+id_checkbox+' class="flat" checked="checked"/> ' + nomService + '<br> <br>');
			                    }
		                	})

		                	if(role_collabo != "Dirigeant"){
			                    	console.log("checkboxDirigeant");
			                    	$('.filtre_services').append('<input type="checkbox" id="checkboxDirigeant" class="flat" checked="checked"/> ' + "Dirigeant" + '<br> <br>');
			                }

		                  }                      
				});
	 		}

	         //icheck
	         if ($("input.flat.mine")[0]) 
	 		 {
		        $(document).ready(function () {
		            $('input.flat.mine').iCheck({
		                checkboxClass: 'icheckbox_flat',
		                radioClass: 'iradio_flat-blue'
		            });
		        });
			}

			if ($("input.flat.other")[0]) 
	 		 {
		        $(document).ready(function () {
		            $('input.flat.other').iCheck({
		                checkboxClass: 'icheckbox_flat-green',
		                radioClass: 'iradio_flat-green'
		            });
		        });
			}     

    	});        
	
	</script>


	<div class="col-md-10">
	<div id="calendar"></div>
	</div>

    <div class="col-md-2">
                <div class="x_panel">
                  <div class="x_title">
                    <h2>Filtre <small></small></h2>                    
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                    <div id="filterCalendar"> 
                      <!-- Collect the nav links, forms, and other content for toggling -->
                      <div class="collapse navbar-collapse navbar-ex1-collapse">
                        <ul class="nav navbar-nav navbar-center">
                        <div class="menu_filtre">
	                         <input type="checkbox"  id="checkboxMesConges"  class="flat" checked="checked" /> Mes congés
	                         <br> <br>

	                         <input type="checkbox" id="checkboxMonService"  class="flat" checked="checked" /> Mon service  
	                         <br> <br>

	                          <div class="filtre_services">
								<!--<input type="checkbox" id="checkbox3"  class="flat" /> RH                <br> <br>
								<input type="checkbox" id="checkbox4"  class="flat" /> Informatique               <br> <br>
								-->	                          	
	                          </div>

	                            <button id="btnreset_filtre" class="btn btn-default btn-block" value="Reset" type="reset" style="margin-bottom:25px">Réinitialiser</button>
                        </div><!-- /.navbar-collapse --> 
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>


