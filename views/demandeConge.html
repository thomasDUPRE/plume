<!DOCTYPE html>
<html lang="en">
  <head>
 

    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->

    <link href="../vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">

    <link href="../vendors/dropzone/dist/min/dropzone.min.css" rel="stylesheet">
    <link src="../vendors/switchery/dist/switchery.css"></link>
    <link href="../vendors/select2/dist/css/select2.min.css" rel="stylesheet">
   
    
    <!-- Custom Theme Style -->
    <link href="../build/css/custom.min.css" rel="stylesheet">
  </head>

        <!-- page content -->
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h3>Demande de congé</h3>
              </div>


              <div class="title_right">
                <div class="col-md-5 col-sm-5 col-xs-12 form-group pull-right top_search">
                 <!--  <div class="input-group"> -->
                     <h3 style="display:inline"> Jours restants : </h3>
                      <h3 style="display:inline" id="daysLeft" class="red">
                             
                      </h3>
                 <!--  </div> -->
                </div>
              </div>
            </div>
            <div class="clearfix"></div>

            <div class="row">
              <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                  <div class="x_title">
                    
                   
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">

                    <form class="form-horizontal form-label-left" action="#" > 
               
                      <div class="item form-group ">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" >Motif du congé <span class="required">*</span>
                        </label>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                          <input id="motif" class="form-control col-md-7 col-xs-12"   placeholder="arrêt maladie, mariage .." required="required" type="text">
                        </div>
                      </div>

                         <div class="item form-group">
                          <label class="control-label col-md-3 col-sm-3 col-xs-12" for="date_debut">Date de prise de congé 
                          <span class="required">*</span>
                          </label>
                          <div class="col-md-6 col-sm-6 col-xs-12 col-lg-3 xdisplay_inputx form-group has-feedback">
                              <input type="text" class="datepicker form-control has-feedback-left" id="date_debut" placeholder="date de début" aria-describedby="inputSuccess2Status4" required>
                              <span class="fa fa-calendar-o form-control-feedback left" aria-hidden="true"></span>
                              <span id="inputSuccess2Status4" class="sr-only">(success)</span>
                           
                          </div>  
                           <div class="col-md-6 col-sm-6 col-xs-12 col-lg-3 xdisplay_inputx form-group has-feedback">
                              <label class="control-label col-md-3 col-sm-3 col-xs-6 col-lg-3
                              " >   Matin:     
                               </label>
 
                              <div class="col-md-6 col-sm-6 col-xs-6   col-lg-1 ">
                                <label>
                                  <input type="radio" class="flat" name ="time-depart" value="true"  /> 
                                </label>
                              </div>

                                <label class="control-label col-lg-offset-1 col-md-3 col-sm-3 col-xs-6 col-lg-5
                              " >   Après-midi:   
                               </label>
 
                              <div class="col-md-6 col-sm-6 col-xs-6   col-lg-1 ">
                                <label>
                                  <input type="radio" name ="time-depart" value="false" class="flat"  /> 
                                </label>
                              </div>
                           
                          </div>   
                      </div>

                      <div class="item form-group">
                          <label class="control-label col-md-3 col-sm-3 col-xs-12" for="date_fin">Date de reprise 
                          <span class="required">*</span>
                          </label>
                          <div class="col-md-6 col-sm-6 col-xs-12 col-lg-3 xdisplay_inputx form-group has-feedback">
                             <input type="text" class="datepicker form-control has-feedback-left" id="date_fin" placeholder="date de fin" aria-describedby="inputSuccess2Status4" required>
                             <span class="fa fa-calendar-o form-control-feedback left" aria-hidden="true"></span>
                              <span id="inputSuccess2Status4" class="sr-only">(success)</span>
                           
                          </div>  
                          <div class="col-md-6 col-sm-6 col-xs-12 col-lg-3 xdisplay_inputx form-group has-feedback">
                              <label class="control-label col-md-3 col-sm-3 col-xs-6 col-lg-3
                              " >   Matin:     
                               </label>
 
                              <div class="col-md-6 col-sm-6 col-xs-6   col-lg-1 ">
                                <label>
                                  <input type="radio" name ="time-retour" value="true"  /> 
                                </label>
                              </div>

                                <label class="control-label col-lg-offset-1 col-md-3 col-sm-3 col-xs-6 col-lg-5
                              " >   Après-midi:   
                               </label>
 
                              <div class="col-md-6 col-sm-6 col-xs-6   col-lg-1 ">
                                <label>
                                  <input type="radio"  name ="time-retour" value="false"   /> 
                                </label>
                              </div>
                           
                          </div>   
                      </div>

                      <div class="item form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" >Nombre de jours pris  :   
                        </label>

                        <div class="col-md-6 col-sm-6 col-xs-12 ">
                            <h3 id="jours"> 
                               0 
                            </h3>
                          </div>

                      </div>

                      <div class="item form-group">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" >Congé sans solde  :   
                        </label>

                        <div class="col-md-6 col-sm-6 col-xs-12 checkbox">
                            <label>
                              <input type="checkbox" id="sansSolde" checked /> 
                            </label>
                          </div>

                      </div>

                      <div class="ln_solid"></div>
                      <div class="form-group">
                        <div class="col-md-6 col-md-offset-3">
                          <button type="button" class="btn btn-warning">Annuler</button>
                          <input id="save" type="submit"  class="btn btn-primary" value="Enregistrer" />
                          <input type ="submit" id="send" class="btn btn-success" value ="Envoyer" />
                        </div>
                      </div>

                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        
        <!-- /page content -->

       

    <!-- validator -->
    <script src="../vendors/validator/validator.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="../vendors/moment/min/moment.min.js"></script>
    <script src="../vendors/moment/locale/fr.js"></script>
    <script src="../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
    <script src="../vendors/dropzone/dist/min/dropzone.min.js"></script>
    <script src="../vendors/switchery/dist/switchery.min.js"></script>
    <script src="../javascripts/bootstrap-notify.js"></script>
     <script src="../build/js/scripts.js"></script>


    <script type="text/javascript">

       
        
        var dateFinChanged = false ;
        var jour_pris ;
        var jour_restant  ;
        var is_paye = 0  ;
        var action ;

        

          function checkSoldeConge () {
              if(is_paye == 1 && jour_restant<jour_pris)
               notifier("warning","<span class='fa fa-exclamation-triangle'> Attention le nombre de jours choisi est supérieur à ce qui vous reste !",null);
             
          }
        
        $(document).ready(function(){
        
          function radioValue (radioName) 
           {
               value =  $('input[name='+radioName+']:checked').val();
               if (value == "false" ) 
                value =  0;
               else 
                value =  1;

               return value ;
           }

          $.get("/name", function(data, status){
            var profile = JSON.parse(data); 
            jour_restant = profile.nb_jours_restants ;
            $("#daysLeft").text(jour_restant);     
          });

          $('.datepicker').daterangepicker({
          startDate : moment().startOf('day'),
          endDate : moment().endOf('day'),
          minDate : moment().startOf('day'),
          isInvalidDate: function  (date) {
             if (date.isoWeekday() == 6 ||  date.isoWeekday() == 7)
               {
                return true ;
               }

               return false;
          },
          singleDatePicker: true,

          singleClasses: "picker_4",
          locale: {
            format: 'DD/MM/YYYY'
        }
        }, function(start, end, label) {
          // console.log(start.toISOString(), end.toISOString(), label);
   
        });

      $("#sansSolde").change(function () {
        if( this.checked)
          is_paye = 0 ;
        else
          is_paye = 1 ;
          checkSoldeConge();
      });

      $("#date_debut").change(function () {
        if (dateFinChanged == false ) 
            {
              $("#date_fin").val( $(this).val() );
            }
            else
            {
               checkDate();

            }

          jour_pris = jourOuvrables( $("#date_debut").val(), $("#date_fin").val(),radioValue("time-depart"),radioValue("time-retour" ));

          checkSoldeConge();

          $("#jours").text(jour_pris);
          
      });

      $("#date_fin").change(function () {
        if (dateFinChanged == false ) 
            {
              dateFinChanged = true ;
              checkDate();
            }
          else
            {
              checkDate();
            }

           jour_pris = jourOuvrables( $("#date_debut").val(), $("#date_fin").val(),radioValue("time-depart"),radioValue("time-retour" ));
           checkSoldeConge();
           $("#jours").text(jour_pris);
          
      });


      $('input[name=time-depart]:radio').click(function () {
            
                jour_pris = jourOuvrables( $("#date_debut").val(), $("#date_fin").val(),radioValue("time-depart"),radioValue("time-retour" ));
                checkSoldeConge();
                 $("#jours").text(jour_pris);
              
          });
       $('input[name=time-retour]:radio').click(function () {
            
                jour_pris = jourOuvrables( $("#date_debut").val(), $("#date_fin").val(),radioValue("time-depart"),radioValue("time-retour" ));
                checkSoldeConge();
                 $("#jours").text(jour_pris);
              
          });
          
          $('input[type=submit]').click(function  (event) {
             action = this.id;
          });

         $("form").submit(function(event){
           
            event.preventDefault();

            departMatin = radioValue("time-depart") ;

            retourMatin = radioValue("time-retour");

            if (jour_pris > 0  )    
              retourMatin = radioValue("time-retour")
                     
            if (jour_pris > 0 )         
               { 
                  debut = moment($("#date_debut").val(),'DD-MM-YYYY');
                  fin = moment($("#date_fin").val(),'DD-MM-YYYY');
                  $.ajax({
                          url: '/insererConge',
                          type: 'POST',
                          dataType: 'json',
                          async:false,
                          data: {
                             date_debut : debut.format() ,
                             part_matin : departMatin ,
                             est_paye : is_paye,
                             revient_matin :retourMatin,
                             motif : $("#motif").val(),
                             date_fin : fin.format() ,
                             nb_jours_pris : jour_pris,
                             action_to_do : action 
                          },
                          success: function(response) {

                            //if (response.type == "CreerConge")
                            
                             //  $("#pageInterne").load("conges.html");

                            if (response.type == "CreerConge")
                            {
                               notifier("success","<span class='fa fa-check'> "+response.message,null);
                             
                              setTimeout(function() {
                                     $("#pageInterne").load("conges.html");
                                }, 3000);  
                             
                            }

                          }
                      });
                 
                      
                }
             
                else
                  {
                    
                    notifier("danger","<span class='fa fa-exclamation-triangle'> Le nombre de jour choisi est nul!",null);
                 
                 }
           
          });
      });
    </script>
  </body>
</html>